# WebSocket Тестовый Сервер

Простой WebSocket сервер, написанный на Go, предназначенный для практики ручного тестирования. Этот сервер предоставляет различные функции WebSocket, которые тестировщики могут использовать для изучения и практики тестирования WebSocket.

## Возможности

- **Сообщения в реальном времени**: Функциональность чата с широковещательной рассылкой сообщений
- **Управление соединениями**: Автоматическая регистрация/отмена регистрации клиентов
- **Типы сообщений**: Поддержка чата, ping/pong, echo и системных сообщений
- **Множественные клиенты**: Поддержка множественных одновременных соединений
- **Интерактивный тестовый клиент**: HTML-интерфейс для тестирования
- **Подробное логирование**: Логирование на стороне сервера для отладки
- **Эндпоинт статуса**: REST API для статуса сервера

## Быстрый старт

### Предварительные требования

- Go 1.21 или новее
- Веб-браузер для тестирования

### Установка и запуск

1. **Клонируйте или скачайте файлы проекта**
2. **Установите зависимости**:
   ```bash
   go mod tidy
   ```

3. **Запустите сервер**:
   ```bash
   go run main.go
   ```
   или
   ```bash
   ./websocket-server
   ```

4. **Откройте тестовый клиент**:
   - Перейдите по адресу `http://localhost:8080` в браузере
   - Интерфейс тестового клиента загрузится автоматически

## Сценарии тестирования

### Базовое тестирование соединений

1. **Одиночное соединение**:
   - Нажмите "Connect" для установки WebSocket соединения
   - Проверьте, что статус изменился на "Connected"
   - Проверьте логи сервера для подтверждения соединения

2. **Множественные соединения**:
   - Откройте несколько вкладок/окон браузера
   - Подключитесь с каждой вкладки под разными именами пользователей
   - Проверьте, что все соединения поддерживаются
   - Протестируйте широковещательную рассылку сообщений между клиентами

3. **Обрыв соединения**:
   - Используйте кнопку "Test Connection Drop"
   - Проверьте правильную очистку и уведомление других клиентов

### Тестирование сообщений

1. **Сообщения чата**:
   - Отправляйте обычные сообщения чата
   - Проверьте, что сообщения рассылаются всем подключенным клиентам
   - Протестируйте с разной длиной сообщений

2. **Ping/Pong**:
   - Используйте кнопку "Send Ping"
   - Проверьте, что сервер отвечает сообщением pong
   - Протестируйте функциональность поддержания соединения

3. **Echo сообщения**:
   - Используйте кнопку "Send Echo"
   - Проверьте, что сервер возвращает эхо сообщения
   - Протестируйте с различными типами контента

4. **Системные сообщения**:
   - Подключайте/отключайте клиентов
   - Проверьте отправку системных уведомлений
   - Проверьте объявления о входе/выходе

### Тестирование граничных случаев

1. **Быстрые сообщения**:
   - Используйте "Test Rapid Messages" для отправки 10 сообщений быстро
   - Проверьте, что все сообщения обрабатываются правильно
   - Проверьте отсутствие потери сообщений или проблем с порядком

2. **Большие сообщения**:
   - Используйте "Test Large Message" для отправки сообщения в 1000 символов
   - Проверьте, что сервер правильно обрабатывает большие нагрузки

3. **Неверный JSON**:
   - Используйте "Test Invalid JSON" для отправки некорректных данных
   - Проверьте, что сервер корректно обрабатывает ошибки
   - Проверьте логирование ошибок

4. **Лимиты соединений**:
   - Откройте много вкладок браузера (10-20)
   - Проверьте, что сервер поддерживает все соединения
   - Протестируйте производительность широковещательной рассылки сообщений

## API Эндпоинты

### WebSocket Эндпоинт
- **URL**: `ws://localhost:8080/websocket`
- **Параметры**: 
  - `username` (необязательный): Установить пользовательское имя
- **Пример**: `ws://localhost:8080/websocket?username=TestUser`

### REST Эндпоинты
- **GET /**: Отдает HTML страницу тестового клиента
- **GET /status**: Возвращает статус сервера и доступные эндпоинты

## Формат сообщений

Все WebSocket сообщения используют JSON формат:

```json
{
  "type": "chat|ping|echo|system|pong",
  "content": "содержимое сообщения",
  "username": "имя отправителя",
  "timestamp": "2024-01-01T12:00:00Z",
  "clientId": "уникальный идентификатор клиента"
}
```

### Типы сообщений

- **chat**: Обычное сообщение чата (рассылается всем клиентам)
- **ping**: Ping сообщение (сервер отвечает pong)
- **echo**: Echo сообщение (сервер возвращает отправителю)
- **system**: Системное уведомление (генерируется сервером)
- **pong**: Pong ответ (генерируется сервером)

## Чек-лист ручного тестирования

### Тестирование соединений
- [ ] Одиночное соединение клиента
- [ ] Множественные соединения клиентов
- [ ] Соединение с пользовательским именем
- [ ] Обработка обрыва соединения
- [ ] Переподключение после обрыва
- [ ] Тестирование лимитов соединений

### Тестирование сообщений
- [ ] Широковещательная рассылка сообщений чата
- [ ] Функциональность ping/pong
- [ ] Обработка echo сообщений
- [ ] Уведомления системных сообщений
- [ ] Порядок сообщений
- [ ] Сохранение сообщений во время соединения

### Обработка ошибок
- [ ] Обработка неверного JSON
- [ ] Обработка больших сообщений
- [ ] Обработка быстрых сообщений
- [ ] Таймаут соединения
- [ ] Перезапуск сервера во время соединения

### Тестирование производительности
- [ ] Множественные одновременные соединения
- [ ] Высокая частота сообщений
- [ ] Большие нагрузки сообщений
- [ ] Мониторинг использования памяти
- [ ] Мониторинг использования CPU

## Логи сервера

Сервер предоставляет подробное логирование:
- События соединений (подключение/отключение)
- Обработка сообщений
- Условия ошибок
- Отслеживание количества клиентов

Следите за терминалом, где запущен сервер, чтобы видеть логи в реальном времени.

## Устранение неполадок

### Частые проблемы

1. **Connection Refused**:
   - Убедитесь, что сервер запущен на порту 8080
   - Проверьте ограничения файрвола
   - Убедитесь, что никакая другая служба не использует порт 8080

2. **Сообщения не рассылаются**:
   - Проверьте консоль браузера на ошибки JavaScript
   - Убедитесь, что WebSocket соединение установлено
   - Проверьте логи сервера на ошибки

3. **Множественные соединения не работают**:
   - Используйте разные вкладки/окна браузера
   - Попробуйте разные браузеры
   - Проверьте логи сервера на лимиты соединений

### Режим отладки

Для дополнительной отладки вы можете изменить код сервера, чтобы добавить более подробное логирование или запустить с подробным выводом.

## Расширение сервера

Этот сервер предназначен для легкого расширения для дополнительных сценариев тестирования:

1. **Добавьте новые типы сообщений** в структуру `Message`
2. **Реализуйте новые обработчики** в функции `readPump`
3. **Добавьте аутентификацию**, изменив обработчик соединений
4. **Реализуйте комнаты/каналы**, расширив структуру Hub
5. **Добавьте сохранение сообщений**, интегрировав с базой данных

## Примечания по безопасности

⚠️ **Этот сервер предназначен только для тестирования и НЕ должен использоваться в продакшене**:
- CORS отключен (разрешает соединения с любого источника)
- Нет аутентификации или авторизации
- Нет ограничения скорости
- Нет валидации входных данных, кроме базового парсинга JSON

Для использования в продакшене реализуйте надлежащие меры безопасности, включая аутентификацию, ограничение скорости, валидацию входных данных и ограничения CORS.

## Примеры тестирования

### Тест 1: Базовое соединение
```bash
# Запустите сервер
./websocket-server

# Откройте браузер и перейдите на http://localhost:8080
# Нажмите "Connect" и проверьте статус "Connected"
```

### Тест 2: Множественные клиенты
```bash
# Откройте 3 вкладки браузера
# В каждой вкладке перейдите на http://localhost:8080
# Подключитесь с разными именами: "User1", "User2", "User3"
# Отправьте сообщение от одного клиента
# Проверьте, что все остальные клиенты получили сообщение
```

### Тест 3: Ping/Pong
```bash
# Подключитесь к серверу
# Нажмите кнопку "Send Ping"
# Проверьте, что получили ответ "pong"
```

### Тест 4: Echo
```bash
# Подключитесь к серверу
# Введите текст в поле сообщения
# Нажмите "Send Echo"
# Проверьте, что получили эхо вашего сообщения
```

## Полезные команды

```bash
# Компиляция сервера
go build -o websocket-server main.go

# Запуск сервера
./websocket-server

# Проверка статуса сервера
curl http://localhost:8080/status

# Тестирование WebSocket соединения (требует wscat)
wscat -c ws://localhost:8080/websocket?username=TestUser
```

## Заключение

Этот WebSocket тестовый сервер предоставляет отличную платформу для изучения и практики тестирования WebSocket соединений. Интерактивный HTML клиент делает тестирование простым и интуитивным, а подробное логирование помогает понять поведение WebSocket в различных сценариях.

Используйте этот сервер для:
- Изучения основ WebSocket
- Практики ручного тестирования
- Тестирования различных сценариев соединений
- Отладки WebSocket приложений
- Демонстрации WebSocket функциональности
